{% extends "base.html" %}
{% load thumbnail %}

{% block cat %}{{ active }}{% endblock cat %}

{% block extra_head_base %}
<script language="javascript" type="text/javascript" src="{{ STATIC_URL }}js/jquery-1.10.2.js"></script>
{% endblock %}

{% block page-header %}{{ producto.descripcion }}{% endblock %}
{% block body %}


        <ul class="list-group">
            <li class="list-group-item">
                <div class="row">
                    <div class="col-xs-2 col-md-2">
                    {% if producto.foto %}
                        <img alt="" src="{{ producto.foto.url }}">
                    {% else %}

                       <p style="margin-top:30px" class="text-center">(todavía no tenemos una foto para este producto)</p>
                    {% endif %}
                    </div>
                    <div class="col-xs-9 col-md-9">
                        <div>
                            <h2>
                                {{ producto.descripcion }}
                            </h2>

                            <dl>
                                <dt>Código UPC</dt>
                                <dd> {{ producto.upc }}</dd>
                            </dl>

                            <div class="row">                        
                                <div class="col-md-5">
                                <table class="table table-striped table-bordered table-hover">
                                    <thead>
                                        <tr>
                                            <th>Sucursal</th>
                                            <th>Precio</th>
                                            <th>Relevado el</th>
                                        </tr>
                                    </thead>
                                    {% for precio in producto.precio_set.all %}
                                    <tr>
                                    <td>{{ precio.sucursal.nombre }}</td>
                                    <td>$ {{ precio.precio }}</td>
                                    <td>{{ precio.created|date:"d/m/Y" }}</td>
                                    </tr>
                                    {% endfor %}
                                </table>
                                </div>

                                <div class="col-md-4">
                                    <script language="javascript" type="text/javascript">
                                    {% autoescape off %}
                                        var dataSeries = {{graph_data}};
                                    {% endautoescape %}
                                    </script>
                                    <div id="placeholder" style="width:400px; height:200px;"></div>
                                    <script type="text/javascript">
                                    $(function(){
                                        function formatearPrecio(v, axis) {
                                            return "$" + v.toFixed(axis.tickDecimals);
                                        }

                                        var options = {
                                            series: {
                                                lines: {
                                                    show: true
                                                },
                                                points: {
                                                    show: true
                                                }
                                            }, 
                                            xaxis: {
                                                mode: "time",
                                                tickLength: 5,
                                                timeformat: "%d/%m",
                                                minTickSize: [1, "day"]
                                            },
                                            yaxis: {
                                                min: 0,
                                                tickFormatter: formatearPrecio
                                            }, 
                                        };

                                        var plot = $.plot("#placeholder", dataSeries, options);

                                    });
                                    </script>
                                </div>
                            </div>

                            <br />
                            <h4>Productos similares</h4>
                            <ul class="list-group">
                            {% for prod in prods_similares %}
                            <li class="list-group-item">
                                <img alt="" src="{{ prod.foto|thumbnail_url:'small' }}">
                                <a href="{{ prod.get_absolute_url }}">{{ prod.descripcion }}</a>
                            </li>
                            {% endfor %}
                            </ul>
                        </div>
                        {% comment %}
                        <div class="comment-text">
                            Awesome design
                        </div>
                        <div class="action">
                            <button title="Edit" class="btn btn-primary btn-xs" type="button">
                                <span class="glyphicon glyphicon-pencil"></span>
                            </button>
                            <button title="Approved" class="btn btn-success btn-xs" type="button">
                                <span class="glyphicon glyphicon-ok"></span>
                            </button>
                            <button title="Delete" class="btn btn-danger btn-xs" type="button">
                                <span class="glyphicon glyphicon-trash"></span>
                            </button>
                        </div>
                        {% endcomment %}
                    </div>
                </div>
            </li>

        </ul>
{% endblock %}
{% block extra_footer %}
<script language="javascript" type="text/javascript" src="{{ STATIC_URL }}js/plugins/flot/jquery.flot.js"></script>
<script language="javascript" type="text/javascript" src="{{ STATIC_URL }}js/plugins/flot/jquery.flot.time.js"></script>
{% endblock %}
